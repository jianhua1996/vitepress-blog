<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器工作原理（一） | jianhua1996's blog</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/vitepress-blog/assets/style.BesfSeuZ.css" as="style">
    <link rel="preload stylesheet" href="/vitepress-blog/vp-icons.css" as="style">
    
    <script type="module" src="/vitepress-blog/assets/app.Cjv8PB3l.js"></script>
    <link rel="preload" href="/vitepress-blog/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/framework.BicIBzvP.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/theme.B8WIHsrt.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/katex.ChWnQ-fc.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/dagre-JOIXM2OF.BU5GJqT9.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/c4Diagram-6F6E4RAY.fwr_l4D2.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/flowDiagram-KYDEHFYC.BwEJWq4N.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/erDiagram-3M52JZNH.CrTpt4T8.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/gitGraphDiagram-GW3U2K7C.DeD_CDvG.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/ganttDiagram-EK5VF46D.KOjGEOVb.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/infoDiagram-LHK5PUON.zcuWgwAa.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/pieDiagram-NIOCPIFQ.CC7k5lqz.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/quadrantDiagram-2OG54O6I.DobkS9Mq.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/xychartDiagram-H2YORKM3.Bs_i2Elv.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/requirementDiagram-QOLK2EJ7.B51jzf0G.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/sequenceDiagram-SKLFT4DO.Cqca9uBS.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/classDiagram-M3E45YP4.CF0MLQEO.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/classDiagram-v2-YAWTLIQI.CF0MLQEO.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/stateDiagram-MI5ZYTHO.DC6MqsYh.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/stateDiagram-v2-5AN5P6BG.Lzrnv89Q.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/journeyDiagram-EWQZEKCU.CRZgI5i_.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/timeline-definition-MYPXXCX6.B5aHllIo.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/mindmap-definition-6CBA2TL7.CE9eblTR.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/kanban-definition-ZSS6B67P.BhTKOgnk.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/sankeyDiagram-4UZDY2LN.CJTNOABu.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/diagram-5UYTHUR4.CpjButbX.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/diagram-ZTM2IBQH.BItsKFuJ.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/blockDiagram-6J76NXCF.7s25Zxjg.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/architectureDiagram-SUXI7LT5.P1LDa3Uw.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/diagram-VMROVX33.sdxLQps0.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/chunks/virtual_mermaid-config.DDnGl6nM.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/posts_浏览器渲染原理（一）.md.Bmje0j7p.lean.js">
    <meta name="author" content="JianHua">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><!--[--><div class="Layout" data-v-7e7646e8 data-v-3c65529d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-f4292e90></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-f4292e90>Skip to content</a><!--]--><!----><header class="VPNav" data-v-3c65529d data-v-9f0e2270><div class="VPNavBar" data-v-9f0e2270 data-v-4fc43c92><div class="wrapper" data-v-4fc43c92><div class="container" data-v-4fc43c92><div class="title" data-v-4fc43c92><div class="VPNavBarTitle" data-v-4fc43c92 data-v-ae5ff01b><a class="title" href="/vitepress-blog/" data-v-ae5ff01b><!--[--><!--]--><!----><span data-v-ae5ff01b>jianhua1996&#39;s blog</span><!--[--><!--]--></a></div></div><div class="content" data-v-4fc43c92><div class="content-body" data-v-4fc43c92><!--[--><!--]--><div class="VPNavBarSearch search" data-v-4fc43c92><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-4fc43c92 data-v-276eed42><span id="main-nav-aria-label" class="visually-hidden" data-v-276eed42> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/vitepress-blog/" tabindex="0" data-v-276eed42 data-v-94849272><!--[--><span data-v-94849272>🏡首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/vitepress-blog/tags" tabindex="0" data-v-276eed42 data-v-94849272><!--[--><span data-v-94849272>🔖分类</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/vitepress-blog/archives" tabindex="0" data-v-276eed42 data-v-94849272><!--[--><span data-v-94849272>📃归档</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-4fc43c92 data-v-5c7ad46c><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-5c7ad46c data-v-cff9991d data-v-cfc776cf><span class="check" data-v-cfc776cf><span class="icon" data-v-cfc776cf><!--[--><span class="vpi-sun sun" data-v-cff9991d></span><span class="vpi-moon moon" data-v-cff9991d></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-4fc43c92 data-v-328af86d data-v-749f3aa4><!--[--><a class="VPSocialLink no-icon" href="https://github.com/jianhua1996" aria-label="github" target="_blank" rel="noopener" data-v-749f3aa4 data-v-6602d5d7><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-4fc43c92 data-v-3964a4a1 data-v-720ae521><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-720ae521><span class="vpi-more-horizontal icon" data-v-720ae521></span></button><div class="menu" data-v-720ae521><div class="VPMenu" data-v-720ae521 data-v-f9036c2f><!----><!--[--><!--[--><!----><div class="group" data-v-3964a4a1><div class="item appearance" data-v-3964a4a1><p class="label" data-v-3964a4a1>Appearance</p><div class="appearance-action" data-v-3964a4a1><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3964a4a1 data-v-cff9991d data-v-cfc776cf><span class="check" data-v-cfc776cf><span class="icon" data-v-cfc776cf><!--[--><span class="vpi-sun sun" data-v-cff9991d></span><span class="vpi-moon moon" data-v-cff9991d></span><!--]--></span></span></button></div></div></div><div class="group" data-v-3964a4a1><div class="item social-links" data-v-3964a4a1><div class="VPSocialLinks social-links-list" data-v-3964a4a1 data-v-749f3aa4><!--[--><a class="VPSocialLink no-icon" href="https://github.com/jianhua1996" aria-label="github" target="_blank" rel="noopener" data-v-749f3aa4 data-v-6602d5d7><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-4fc43c92 data-v-e98e4c83><span class="container" data-v-e98e4c83><span class="top" data-v-e98e4c83></span><span class="middle" data-v-e98e4c83></span><span class="bottom" data-v-e98e4c83></span></span></button></div></div></div></div><div class="divider" data-v-4fc43c92><div class="divider-line" data-v-4fc43c92></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-3c65529d data-v-4e2ec5af><div class="container" data-v-4e2ec5af><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-4e2ec5af data-v-2f0415c1><button data-v-2f0415c1>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-3c65529d data-v-4bf2fcca><div class="VPDoc has-aside" data-v-4bf2fcca data-v-18e178a6><!--[--><!--]--><div class="container" data-v-18e178a6><div class="aside" data-v-18e178a6><div class="aside-curtain" data-v-18e178a6></div><div class="aside-container" data-v-18e178a6><div class="aside-content" data-v-18e178a6><div class="VPDocAside" data-v-18e178a6 data-v-ea9681f8><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-ea9681f8 data-v-d2a8ce69><div class="content" data-v-d2a8ce69><div class="outline-marker" data-v-d2a8ce69></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-d2a8ce69>On this page</div><ul class="VPDocOutlineItem root" data-v-d2a8ce69 data-v-0b619324><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-ea9681f8></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-18e178a6><div class="content-container" data-v-18e178a6><!--[--><!--[--><!--[--><!--[--><h1 class="title" data-v-9ab37b3d>浏览器工作原理（一）</h1><div class="date" data-v-9ab37b3d>🕒 Published at: </div><!--]--><!----><!--]--><!--]--><!--]--><main class="main" data-v-18e178a6><div style="position:relative;" class="vp-doc _vitepress-blog_posts_%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86%EF%BC%88%E4%B8%80%EF%BC%89" data-v-18e178a6><div><h2 id="浏览器的多进程架构" tabindex="-1">浏览器的多进程架构 <a class="header-anchor" href="#浏览器的多进程架构" aria-label="Permalink to &quot;浏览器的多进程架构&quot;">​</a></h2><h3 id="进程与线程" tabindex="-1">进程与线程 <a class="header-anchor" href="#进程与线程" aria-label="Permalink to &quot;进程与线程&quot;">​</a></h3><p><strong>进程</strong>：指计算机中已执行的程序，曾经是分时系统的基本运作单位。在面向进程设计的系统中，是程序的基本执行实体；在面向线程设计的系统中，进程本身不是基本执行单位，而是线程的容器。<br><strong>线程</strong>：在计算机科学中，是将进程划分为两个或多个线程（实例）或子进程，由单处理器（单线程）或多处理器（多线程）或多核处理系统并发执行。<br> 参考：<a href="https://zh.wikipedia.org/zh-cn/%E8%A1%8C%E7%A8%8B" target="_blank" rel="noreferrer">进程</a>、<a href="https://zh.wikipedia.org/zh-cn/%E7%BA%BF%E7%A8%8B" target="_blank" rel="noreferrer">线程</a></p><h3 id="浏览器的进程架构" tabindex="-1">浏览器的进程架构 <a class="header-anchor" href="#浏览器的进程架构" aria-label="Permalink to &quot;浏览器的进程架构&quot;">​</a></h3><p><strong>现代浏览器一般都是多进程架构</strong>，以 Chrome 为例，一个浏览器会启动包括以下进程在内的多个进程，每个进程都有自己的内存空间，进程之间通过 <code>IPC</code> 进行通信：</p><ul><li>浏览器主进程</li><li>GPU 进程</li><li>网络进程</li><li>存储进程</li><li>渲染进程</li><li>插件进程</li></ul><p>下面是浏览器的进程截图：</p><div class="image-builder" style="width:100%;display:flex;flex-wrap:wrap;justify-content:initial;"><!--[--><img src="/vitepress-blog/浏览器进程架构.png" alt="image" style="object-fit:contain;width:calc(100% / 3 * 2);"><!--]--></div><p>其中，<strong>渲染进程</strong>是我们最应该关注的进程，它负责通过一系列渲染步骤（又称作浏览器渲染管线）将 HTML、JavaScript、CSS、图片等资源最终解析为可以显示和交互的页面。</p><p><strong>浏览器中的渲染进程不止会有一个</strong>，通常来讲，我们每次在浏览器中打开一个新的标签页，就会启动一个新的渲染进程。如果是在当前页面打开或跳转，浏览器会判断新页面是否与当前页面属于<strong>同站页面</strong>：</p><blockquote><p>所谓同站：指的是两个 URL 具有<strong>相同的有效顶级域名 + 二级域名部分</strong>，也就是 eTLD+1</p></blockquote><p><strong>如果是同站页面，则复用当前页面的渲染进程，否则就会启动一个新的渲染进程</strong>。</p><blockquote><p>对比同源：指的是 <strong>协议(Scheme)</strong>、<strong>主机名(Hostname)</strong> 和 <strong>端口号(Port)</strong> 完全相同。</p></blockquote><p>如下图所示：</p><div class="image-builder" style="width:100%;display:flex;flex-wrap:wrap;justify-content:initial;"><!--[--><img src="/vitepress-blog/浏览器进程架构-同站进程复用1.png" alt="image" style="object-fit:contain;width:calc(100% / 3 * 2);"><img src="/vitepress-blog/浏览器进程架构-同站进程复用2.png" alt="image" style="object-fit:contain;width:calc(100% / 3 * 2);"><img src="/vitepress-blog/浏览器进程架构-同站进程复用3.png" alt="image" style="object-fit:contain;width:calc(100% / 3 * 2);"><!--]--></div><p><code>baidu.com</code> 和 <code>tieba.baidu.com</code> 复用同一个浏览器进程，因为它们是同站页面。<br> 而 <code>baidu.com</code> 和 <code>taobao.com</code> 则不会复用同一个浏览器进程，因为它们不是同站页面。</p><blockquote><p>多进程架构的优势：崩溃隔离，沙箱化等，参考<a href="https://developer.chrome.com/blog/inside-browser-part1?hl=zh-cn#the_benefit_of_multi-process_architecture_in_chrome" target="_blank" rel="noreferrer">Chrome 中多进程架构的好处</a></p></blockquote><hr><h2 id="浏览器渲染管线" tabindex="-1">浏览器渲染管线 <a class="header-anchor" href="#浏览器渲染管线" aria-label="Permalink to &quot;浏览器渲染管线&quot;">​</a></h2><p>我们把从输入数据（通常是 HTML、CSS、JavaScript）到显示结果（屏幕上看到的画面）这整个过程称为浏览器的渲染流程，或者叫渲染管线。</p><p>按照渲染的时间顺序，渲染管线可分为如下几个子阶段：</p><ol><li>构建 DOM 树</li><li>样式计算</li><li>布局阶段</li><li>分层阶段</li><li>绘制阶段</li><li>分块</li><li>光栅化</li><li>合成</li></ol><p>这个过程也被称为<a href="https://developer.mozilla.org/en-US/docs/Web/Performance/Critical_rendering_path" target="_blank" rel="noreferrer">关键渲染路径(Critical Rendering Path)</a>。</p><h3 id="_1-html-解析与-dom-树构建流程" tabindex="-1">1. HTML 解析与 DOM 树构建流程 <a class="header-anchor" href="#_1-html-解析与-dom-树构建流程" aria-label="Permalink to &quot;1. HTML 解析与 DOM 树构建流程&quot;">​</a></h3><p>HTML 解析是浏览器渲染管线的第一步，它将 HTML 文档转换为 DOM 树。这个过程遵循<a href="https://html.spec.whatwg.org/multipage/parsing.html#parsing" target="_blank" rel="noreferrer">WHATWG HTML 标准</a>中定义的算法。</p><h4 id="_1-1-字节流解码-byte-decoding" tabindex="-1">1.1 字节流解码（Byte Decoding） <a class="header-anchor" href="#_1-1-字节流解码-byte-decoding" aria-label="Permalink to &quot;1.1 字节流解码（Byte Decoding）&quot;">​</a></h4><p><strong>目标</strong>：将原始字节流转换为可读字符<br><strong>编码识别顺序</strong>：</p><ol><li><a href="https://encoding.spec.whatwg.org/#bom-sniff" target="_blank" rel="noreferrer">BOM 嗅探</a> (BOM sniffing)（最高优先级）</li><li>检查 HTTP 响应头中的<code>Content-Type</code>字段（如<code>Content-Type: text/html; charset=UTF-8</code>）</li><li>检查文档是否与一个已确定编码的 <code>Document</code> 关联(需同源)，如果是，使用关联的 <code>Document</code> 编码</li><li>检查 HTML 文档中的 <code>&lt;meta&gt;</code>标签 <ul><li>对于 HTML5 文档，优先识别<code>&lt;meta charset=&quot;UTF-8&quot;&gt;</code></li><li>对于旧版 HTML，识别<code>&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=GBK&quot;&gt;</code></li></ul></li><li>检查资源地址/用户地区设置</li></ol><blockquote><p>BOM 优先级最高，若存在 BOM 则忽略 HTTP 头中的 charset 声明</p></blockquote><hr><h4 id="_1-2-令牌化-tokenization" tabindex="-1">1.2 令牌化（Tokenization） <a class="header-anchor" href="#_1-2-令牌化-tokenization" aria-label="Permalink to &quot;1.2 令牌化（Tokenization）&quot;">​</a></h4><p><strong>目标</strong>：将字符串切割为有意义的语法单元（Tokens）<br><strong>分词规则</strong>：</p><ul><li><code>&lt;div&gt;</code> → <strong>开始标签 Token</strong></li><li><code>&lt;/div&gt;</code> → <strong>结束标签 Token</strong></li><li><code>id=&quot;app&quot;</code> → <strong>属性 Token</strong>（作为开始标签的一部分）</li><li><code>Hello</code> → <strong>文本 Token</strong>，标签之间的文字</li><li><code>&lt;!-- 注释内容 --&gt;</code> → <strong>注释 Token</strong></li></ul><p>这一阶段会处理 HTML 的 &quot;容错性&quot;：对不规范语法（如未闭合标签、错误嵌套）进行自动修正</p><hr><h4 id="_1-3-dom-树构建-tree-construction" tabindex="-1">1.3 DOM 树构建（Tree Construction） <a class="header-anchor" href="#_1-3-dom-树构建-tree-construction" aria-label="Permalink to &quot;1.3 DOM 树构建（Tree Construction）&quot;">​</a></h4><p><strong>目标</strong>：将 Token 序列转换为具有层级关系的 DOM（文档对象模型）树<br><strong>关键机制</strong>：</p><ul><li>使用<a href="https://html.spec.whatwg.org/multipage/parsing.html#the-stack-of-open-elements" target="_blank" rel="noreferrer">开放元素栈</a>维护元素的层级关系</li><li>根据令牌类型创建相应的节点： <ul><li>开始标签令牌创建元素节点</li><li>文本令牌创建文本节点</li><li>注释令牌创建注释节点</li><li>结束标签令牌不创建节点，而是完成元素的构建</li></ul></li><li>每个节点根据 HTML 规范确立父-子-兄弟关系</li></ul><p><strong>HTML 容错处理</strong>：</p><ul><li>自动补全缺失的<code>&lt;html&gt;</code>、<code>&lt;head&gt;</code>、<code>&lt;body&gt;</code>标签</li><li>纠正错误的嵌套顺序（如<code>&lt;p&gt;</code>中嵌套<code>&lt;div&gt;</code>时自动闭合<code>&lt;p&gt;</code>）</li><li>处理未闭合的标签</li></ul><p><strong>脚本处理</strong>：</p><p>当解析器遇到<code>&lt;script&gt;</code>标签时，会暂停 DOM 构建并执行脚本：</p><ol><li>按文档顺序同步阻塞解析（除非标记<code>defer</code>/<code>async</code>）</li><li>脚本仅能访问<strong>已构建</strong>的 DOM 节点</li><li>特殊行为： <ul><li><code>document.write()</code>：在解析中调用时<strong>插入新内容并重启解析</strong></li></ul></li></ol><hr><h4 id="_1-4-文档就绪事件-document-readiness" tabindex="-1">1.4 文档就绪事件（Document Readiness） <a class="header-anchor" href="#_1-4-文档就绪事件-document-readiness" aria-label="Permalink to &quot;1.4 文档就绪事件（Document Readiness）&quot;">​</a></h4><p><strong>事件触发逻辑</strong>：</p><div class="mermaid"></div><h4 id="构建过程的核心优化机制" tabindex="-1">构建过程的核心优化机制 <a class="header-anchor" href="#构建过程的核心优化机制" aria-label="Permalink to &quot;构建过程的核心优化机制&quot;">​</a></h4><ul><li><p><strong>增量构建（Incremental Build）</strong></p><ul><li>浏览器采用增量构建策略，在解析过程中<strong>分批生成 DOM 节点</strong>（无固定大小阈值），允许用户提前看到部分内容（如文本先显示）</li></ul></li><li><p><strong>预解析扫描器（Preload Scanner）</strong></p><ul><li>主解析器在解析 HTML 时，会启动一个轻量级的扫描器（独立线程）提前发现并下载 CSS/JS/图片资源</li></ul></li><li><p><strong>回流最小化（Layout Thrashing Avoidance）</strong></p><ul><li>构建过程中如果 JS 读取布局属性（如 offsetHeight），会强制触发同步布局计算（重排），导致性能问题，因此应避免在 DOM 构建过程中读取布局属性</li></ul></li></ul><h3 id="_2-样式计算" tabindex="-1">2. 样式计算 <a class="header-anchor" href="#_2-样式计算" aria-label="Permalink to &quot;2. 样式计算&quot;">​</a></h3><p>样式计算是浏览器渲染管线中的关键步骤，它将 DOM 树和 CSS 规则结合生成带有样式的渲染树。此过程遵循<a href="https://www.w3.org/TR/css-syntax-3/" target="_blank" rel="noreferrer">W3C CSS Syntax Level 3</a>和<a href="https://www.w3.org/TR/css-cascade-4/" target="_blank" rel="noreferrer">CSS Cascading and Inheritance Level 4</a>等规范。</p><h4 id="_2-1-cssom-树构建" tabindex="-1">2.1 CSSOM 树构建 <a class="header-anchor" href="#_2-1-cssom-树构建" aria-label="Permalink to &quot;2.1 CSSOM 树构建&quot;">​</a></h4><div class="mermaid"></div><p><strong>关键步骤</strong>：</p><ol><li><strong>CSS 解析器初始化</strong><ul><li>创建样式表对象（CSSStyleSheet）</li><li>初始化规则列表（CSSRuleList）</li></ul></li><li><strong>规则解析</strong>：<div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="复制代码" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes one-dark-pro one-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">// CSS 规范定义的规则类型（根据CSS Object Model规范）</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">interface</span><span style="--shiki-dark:#E5C07B;--shiki-light:#C18401;"> CSSRule</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">	const</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> unsigned</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> short</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">      STYLE_RULE</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> =</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">	const</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> unsigned</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> short</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">      CHARSET_RULE</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> =</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 2</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">	const</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> unsigned</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> short</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">      IMPORT_RULE</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> =</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 3</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">	const</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> unsigned</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> short</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">      MEDIA_RULE</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> =</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 4</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">	const</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> unsigned</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> short</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">      FONT_FACE_RULE</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> =</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 5</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">	const</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> unsigned</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> short</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">      PAGE_RULE</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> =</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 6</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">	const</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> unsigned</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> short</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">      KEYFRAMES_RULE</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> =</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 7</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">	const</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> unsigned</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> short</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">      NAMESPACE_RULE</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> =</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 10</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li><li><strong>错误处理</strong>： <ul><li>根据 <a href="https://www.w3.org/TR/css-syntax-3/#error-handling" target="_blank" rel="noreferrer">CSS Parsing Level 3 规范</a>，跳过无效规则</li><li>保留有效部分继续解析</li></ul></li></ol><h4 id="_2-2-样式规则匹配" tabindex="-1">2.2 样式规则匹配 <a class="header-anchor" href="#_2-2-样式规则匹配" aria-label="Permalink to &quot;2.2 样式规则匹配&quot;">​</a></h4><p><strong>匹配过程</strong>：</p><div class="mermaid"></div><p><strong>匹配算法</strong>：</p><ol><li><strong>从右向左匹配</strong>： <ul><li>先匹配最具体的选择器部分（如.class 或#id）</li><li>再验证祖先关系（如 div .class）</li></ul></li><li><strong>选择器特异性计算</strong>：</li></ol><div class="language-text vp-adaptive-theme line-numbers-mode"><button title="复制代码" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes one-dark-pro one-light vp-code" tabindex="0"><code><span class="line"><span>特异性值 = (a, b, c, d)</span></span>
<span class="line"><span>a = 来自style属性的规则（存在则为1，否则0）</span></span>
<span class="line"><span>b = ID选择器的规则数量</span></span>
<span class="line"><span>c = 类/属性/伪类选择器的规则数量</span></span>
<span class="line"><span>d = 元素/伪元素选择器的规则数量</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li><strong>规则匹配优化</strong>： <ul><li>使用 Bloom 过滤器快速排除不匹配规则</li><li>对常见选择器模式建立索引</li></ul></li></ol><h4 id="_2-3-优先级计算-层叠算法" tabindex="-1">2.3 优先级计算（层叠算法） <a class="header-anchor" href="#_2-3-优先级计算-层叠算法" aria-label="Permalink to &quot;2.3 优先级计算（层叠算法）&quot;">​</a></h4><p>样式层叠遵循<a href="https://www.w3.org/TR/css-cascade-4/#cascading" target="_blank" rel="noreferrer">CSS Cascading and Inheritance 规范</a>定义的层叠顺序：</p><ol><li><p><strong>来源优先级（升序）</strong>：</p><div class="language-text vp-adaptive-theme line-numbers-mode"><button title="复制代码" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes one-dark-pro one-light vp-code" tabindex="0"><code><span class="line"><span>1. 用户代理声明（user agent declarations）</span></span>
<span class="line"><span>2. 用户普通声明（user normal declarations）</span></span>
<span class="line"><span>3. 作者普通声明（author normal declarations）</span></span>
<span class="line"><span>4. 作者重要声明（author important declarations）</span></span>
<span class="line"><span>5. 用户重要声明（user important declarations）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>名词解释：用户代理声明，浏览器厂商提供的默认样式（即浏览器内置样式）；用户声明，浏览网站的用户定义的样式（比如通过插件书写的样式）；作者声明，由网站开发者编写的 CSS 样式，包括内联样式、嵌入样式、外部样式。</p></blockquote></li><li><p><strong>特异性比较</strong>：</p><ul><li>比较<code>(a,b,c,d)</code>元组，从左到右比较数值</li><li>例如：<code>(1,0,0,0) &gt; (0,2,3,0)</code></li></ul></li><li><p><strong>出现顺序</strong>：</p><ul><li>特异性相同的规则，后出现的覆盖先出现的</li></ul></li></ol><h4 id="_2-4-继承处理" tabindex="-1">2.4 继承处理 <a class="header-anchor" href="#_2-4-继承处理" aria-label="Permalink to &quot;2.4 继承处理&quot;">​</a></h4><p><strong>继承机制</strong>：</p><div class="mermaid"></div><p><strong>关键规则</strong>：</p><ol><li><p><strong>可继承属性</strong></p><ul><li>字体相关：font-family, font-size</li><li>文本相关：color, line-height</li><li>可见性：visibility</li><li>列表属性：list-style</li></ul></li><li><p><strong>继承值计算</strong>：</p><p>根据 <a href="https://www.w3.org/TR/css-cascade-4/#inheriting" target="_blank" rel="noreferrer">CSS Cascading and Inheritance 规范</a>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="复制代码" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes one-dark-pro one-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">if</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> (</span><span style="--shiki-dark:#E5C07B;--shiki-light:#383A42;">property</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">.</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">isInherited</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) {</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">	computedValue</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> =</span><span style="--shiki-dark:#E5C07B;--shiki-light:#383A42;"> parent</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">.</span><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">computedValue</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">} </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">else</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">	computedValue</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> =</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;"> initialValue</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>特殊关键字</strong>：</p><ul><li>inherit：强制继承父元素值</li><li>initial：使用规范初始值</li><li>unset：自动选择 inherit 或 initial</li><li>revert：回滚到用户代理样式</li></ul></li></ol><h4 id="_2-5-默认值应用" tabindex="-1">2.5 默认值应用 <a class="header-anchor" href="#_2-5-默认值应用" aria-label="Permalink to &quot;2.5 默认值应用&quot;">​</a></h4><ol><li><p><strong>未定义属性处理</strong>：</p><ul><li>使用属性规范定义的初始值</li><li>例如：display 初始值为 inline</li></ul></li><li><p><strong>CSS 全局关键字</strong>：</p><table tabindex="0"><thead><tr><th>关键字</th><th>行为</th></tr></thead><tbody><tr><td>initial</td><td>将属性重置为 CSS 规范定义的初始值</td></tr><tr><td>inherit</td><td>继承父元素的值</td></tr><tr><td>unset</td><td>继承属性使用 inherit，非继承属性使用 initial</td></tr><tr><td>revert</td><td>回滚到用户代理样式</td></tr></tbody></table></li><li><p><strong>UA 样式表应用</strong>：</p><div class="language-css vp-adaptive-theme line-numbers-mode"><button title="复制代码" class="copy"></button><span class="lang">css</span><pre class="shiki shiki-themes one-dark-pro one-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">/* 浏览器默认样式示例 */</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">html</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> {</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">	display: </span><span style="--shiki-dark:#D19A66;--shiki-light:#383A42;">block</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">; </span><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">/* 根元素初始值为block */</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">}</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">head</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> {</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">	display: </span><span style="--shiki-dark:#D19A66;--shiki-light:#383A42;">none</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">;</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol><h4 id="_2-6-相对值转换" tabindex="-1">2.6 相对值转换 <a class="header-anchor" href="#_2-6-相对值转换" aria-label="Permalink to &quot;2.6 相对值转换&quot;">​</a></h4><table tabindex="0"><thead><tr><th>相对单位</th><th>转换依据</th><th>示例</th></tr></thead><tbody><tr><td>em, rem</td><td>字体大小</td><td>1em = 父元素 font-size</td></tr><tr><td>%</td><td>包含块尺寸</td><td>width: 50%</td></tr><tr><td>vw, vh</td><td>视口尺寸</td><td>1vw = 1%视口宽度</td></tr><tr><td>ch, ex</td><td>字符尺寸</td><td>基于当前字体</td></tr><tr><td>calc()</td><td>数学表达式计算</td><td>calc(100% - 20px)</td></tr></tbody></table><p><strong>计算过程</strong>：</p><ol><li>递归解析表达式</li><li>单位统一转换</li><li>最终值计算</li></ol><h4 id="_2-7-样式属性标准化" tabindex="-1">2.7 样式属性标准化 <a class="header-anchor" href="#_2-7-样式属性标准化" aria-label="Permalink to &quot;2.7 样式属性标准化&quot;">​</a></h4><p><strong>标准化操作</strong>：</p><ol><li><p><strong>简写属性展开</strong>：</p><div class="language-css vp-adaptive-theme line-numbers-mode"><button title="复制代码" class="copy"></button><span class="lang">css</span><pre class="shiki shiki-themes one-dark-pro one-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">/* 输入 */</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">margin: 10px;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">/* 展开为 */</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">margin-top</span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">: 10px;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">margin-right</span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">: 10px;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">margin-bottom</span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">: 10px;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">margin-left</span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">: 10px;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li><li><p><strong>关键字转换</strong>：</p><ul><li>auto → 具体计算值</li><li>currentColor → 解析为当前 color 值</li></ul></li><li><p><strong>规范化值</strong>：</p><ul><li>颜色：#RGB → #RRGGBB</li><li>长度：0px → 0</li><li>角度：360deg → 0deg</li></ul></li></ol><h4 id="_2-8-媒体查询应用" tabindex="-1">2.8 媒体查询应用 <a class="header-anchor" href="#_2-8-媒体查询应用" aria-label="Permalink to &quot;2.8 媒体查询应用&quot;">​</a></h4><div class="mermaid"></div><p><strong>检测维度</strong>：</p><ol><li>设备类型：screen, print, speech</li><li>视口尺寸：width, height</li><li>显示特性：resolution, orientation</li><li>用户偏好：prefers-color-scheme</li></ol><h4 id="_2-9-伪元素-类处理" tabindex="-1">2.9 伪元素/类处理 <a class="header-anchor" href="#_2-9-伪元素-类处理" aria-label="Permalink to &quot;2.9 伪元素/类处理&quot;">​</a></h4><ol><li><p><strong>伪类匹配</strong>：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="复制代码" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes one-dark-pro one-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">for</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> (</span><span style="--shiki-dark:#E06C75;--shiki-light:#383A42;">element</span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;"> of</span><span style="--shiki-dark:#E5C07B;--shiki-light:#986801;"> DOM</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) {</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">	if</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> (</span><span style="--shiki-dark:#E5C07B;--shiki-light:#383A42;">element</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">.</span><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;">matches</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;:hover&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)) {</span></span>
<span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;">		applyHoverStyles</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">()</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">	}</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>伪元素处理</strong>：</p><ul><li>伪元素（如::before, ::after）不是真实 DOM 节点，而是在渲染时生成的虚拟节点</li><li>应用对应样式规则并在渲染树中创建相应渲染对象</li></ul></li></ol><h4 id="_2-10-计算样式树构建" tabindex="-1">2.10 计算样式树构建 <a class="header-anchor" href="#_2-10-计算样式树构建" aria-label="Permalink to &quot;2.10 计算样式树构建&quot;">​</a></h4><div class="mermaid"></div><p><strong>优化机制</strong>：</p><ol><li>增量更新（仅修改受影响节点）</li><li>样式共享（相同样式节点复用）</li><li>缓存计算结果</li></ol></div></div></main><footer class="VPDocFooter" data-v-18e178a6 data-v-990bac94><!--[--><!--]--><div class="edit-info" data-v-990bac94><!----><div class="last-updated" data-v-990bac94><p class="VPLastUpdated" data-v-990bac94 data-v-eec817db>最后更新于: <time datetime="2025-07-27T13:06:57.000Z" data-v-eec817db></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-990bac94><span class="visually-hidden" id="doc-footer-aria-label" data-v-990bac94>Pager</span><div class="pager" data-v-990bac94><!----></div><div class="pager" data-v-990bac94><a class="VPLink link pager-link next" href="/vitepress-blog/posts/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86%EF%BC%88%E4%BA%8C%EF%BC%89" data-v-990bac94><!--[--><span class="desc" data-v-990bac94>下一篇</span><span class="title" data-v-990bac94>浏览器工作原理（二）</span><!--]--></a></div></nav></footer><!--[--><!--[--><!--[--><div data-v-7e7646e8><button data-v-7e7646e8>cd ··</button></div><div id="gitalk-container" data-v-7e7646e8></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div><footer data-v-7e7646e8 data-v-bf173662>Theme Powered by clark-cui | Copyright ©</footer><!--]--></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"archives.md\":\"B1CAavtD\",\"index.md\":\"DGt6vm6z\",\"posts_flutter小项目展示.md\":\"BhDULjwL\",\"posts_flutter组件学习（一）.md\":\"BXi9h1Fu\",\"posts_flutter组件学习（二）.md\":\"L0t3MnOK\",\"posts_事件循环.md\":\"gB72YAyn\",\"posts_作为测试文章.md\":\"B7a59TMZ\",\"posts_前端开发常见错觉.md\":\"CEph_tPH\",\"posts_前端面试题整理：vue篇（一）.md\":\"Cqqdo_fa\",\"posts_前端面试题整理：vue篇（二）.md\":\"DRGtWaP8\",\"posts_前端面试题整理：杂篇（一）.md\":\"Dri0ubWA\",\"posts_浏览器渲染原理（一）.md\":\"Bmje0j7p\",\"posts_浏览器渲染原理（二）.md\":\"BrrPaJPl\",\"readme.md\":\"SHzNu8_x\",\"tags.md\":\"BTsTIONv\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"jianhua1996's blog\",\"description\":\"A VitePress site\",\"base\":\"/vitepress-blog/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"avator\":\"logo.jpg\",\"search\":{\"provider\":\"local\"},\"docsDir\":\"/\",\"posts\":[{\"frontMatter\":{\"title\":\"浏览器工作原理（二）\",\"tags\":[\"浏览器\",\"渲染原理\",\"reflow\",\"repaint\",\"关键渲染路径\"],\"date\":\"2025-07-27\",\"prev\":{\"text\":\"浏览器工作原理（一）\",\"link\":\"/posts/浏览器渲染原理（一）.md\"}},\"regularPath\":\"/posts/浏览器渲染原理（二）.html\"},{\"frontMatter\":{\"title\":\"浏览器工作原理（一）\",\"tags\":[\"浏览器\",\"渲染原理\",\"reflow\",\"repaint\",\"关键渲染路径\"],\"date\":\"2025-06-29\",\"next\":{\"text\":\"浏览器工作原理（二）\",\"link\":\"/posts/浏览器渲染原理（二）.md\"}},\"regularPath\":\"/posts/浏览器渲染原理（一）.html\"},{\"frontMatter\":{\"title\":\"前端面试题整理：杂篇（一）\",\"tags\":[\"前端\",\"面试\",\"Vue\",\"HTML\",\"CSS\",\"JavaScript\"],\"date\":\"2025-03-20\"},\"regularPath\":\"/posts/前端面试题整理：杂篇（一）.html\"},{\"frontMatter\":{\"title\":\"前端工作中的经验与教训\",\"tags\":[\"前端\",\"Vue\",\"JavaScript\",\"双向绑定\"],\"date\":\"2025-03-18\"},\"regularPath\":\"/posts/前端开发常见错觉.html\"},{\"frontMatter\":{\"title\":\"前端面试题整理：Vue篇（二）\",\"tags\":[\"前端\",\"面试\",\"Vue\",\"HTML\",\"CSS\",\"JavaScript\"],\"date\":\"2024-10-18\"},\"regularPath\":\"/posts/前端面试题整理：Vue篇（二）.html\"},{\"frontMatter\":{\"title\":\"前端面试题整理：Vue篇（一）\",\"tags\":[\"前端\",\"面试\",\"Vue\",\"HTML\",\"CSS\",\"JavaScript\"],\"date\":\"2024-10-17\"},\"regularPath\":\"/posts/前端面试题整理：Vue篇（一）.html\"},{\"frontMatter\":{\"title\":\"Flutter小项目展示\",\"tags\":[\"Flutter\",\"Dart\",\"Widget\"],\"date\":\"2024-10-09\"},\"regularPath\":\"/posts/Flutter小项目展示.html\"},{\"frontMatter\":{\"title\":\"Flutter组件学习（二）\",\"tags\":[\"Flutter\",\"Dart\",\"Widget\",\"Card\",\"ListTile\",\"CircleAvatar\",\"Divider\"],\"date\":\"2024-10-06\"},\"regularPath\":\"/posts/Flutter组件学习（二）.html\"},{\"frontMatter\":{\"title\":\"Flutter组件学习（一）\",\"tags\":[\"Flutter\",\"Dart\",\"Widget\",\"Container\",\"Rows\",\"Columns\",\"Image\",\"Text\",\"Icon\",\"SafeArea\"],\"date\":\"2024-10-04\"},\"regularPath\":\"/posts/Flutter组件学习（一）.html\"},{\"frontMatter\":{\"title\":\"事件循环\",\"tags\":[\"事件循环\",\"Message Loop\",\"js事件循环\"],\"date\":\"2024-03-12\"},\"regularPath\":\"/posts/事件循环.html\"},{\"frontMatter\":{\"title\":\"测试文章\",\"description\":\"测试测试\",\"tag\":null,\"date\":\"2024-02-15\"},\"regularPath\":\"/posts/作为测试文章.html\"}],\"pageSize\":8,\"postLength\":11,\"nav\":[{\"text\":\"🏡首页\",\"link\":\"/\"},{\"text\":\"🔖分类\",\"link\":\"/tags\"},{\"text\":\"📃归档\",\"link\":\"/archives\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/jianhua1996\"}],\"outline\":[2,4],\"showFireworksAnimation\":false,\"lastUpdatedText\":\"最后更新于\",\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>