import{_ as n,C as s,c as l,o as a,j as e,b as i,a4 as h,a as d,w as r,G as c,a5 as p}from"./chunks/framework.BicIBzvP.js";const x=JSON.parse('{"title":"浏览器渲染原理（三）","description":"","frontmatter":{"title":"浏览器渲染原理（三）","tags":["浏览器","渲染原理","reflow","repaint","关键渲染路径"],"date":"2025-8-23","prev":{"text":"浏览器渲染原理（二）","link":"/posts/浏览器渲染原理（二）.md"}},"headers":[],"relativePath":"posts/浏览器渲染原理（三）.md","filePath":"posts/浏览器渲染原理（三）.md","lastUpdated":1756559909000}'),_={name:"posts/浏览器渲染原理（三）.md"};function b(E,t,m,g,u,B){const o=s("Mermaid");return a(),l("div",null,[t[1]||(t[1]=e("h2",{id:"浏览器渲染管线",tabindex:"-1"},[d("浏览器渲染管线 "),e("a",{class:"header-anchor",href:"#浏览器渲染管线","aria-label":'Permalink to "浏览器渲染管线"'},"​")],-1)),t[2]||(t[2]=e("h3",{id:"_5-绘制-painting",tabindex:"-1"},[d("5 绘制（Painting） "),e("a",{class:"header-anchor",href:"#_5-绘制-painting","aria-label":'Permalink to "5 绘制（Painting）"'},"​")],-1)),t[3]||(t[3]=e("p",null,[d("绘制发生在主线程 ​​，目标是将布局树中的元素转换为"),e("strong",null,"绘制指令列表（Paint Records）"),d(" ​​，为后续的合成阶段提供数据支持。")],-1)),(a(),i(p,null,{default:r(()=>[c(o,{id:"mermaid-9",class:"mermaid",graph:"flowchart%20LR%0A%20%20A%5B%E5%B8%83%E5%B1%80%E6%A0%91%5D%20--%3E%20B%5B%E7%94%9F%E6%88%90%E7%BB%98%E5%88%B6%E6%8C%87%E4%BB%A4%5D%0A%20%20B%20--%3E%20C%5B%E5%85%89%E6%A0%85%E5%8C%96%5D%0A%20%20C%20--%3E%20D%5B%E4%BD%8D%E5%9B%BE%E6%95%B0%E6%8D%AE%5D%0A%20%20D%20--%3E%20E%5B%E5%90%88%E6%88%90%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%5D%0A"})]),fallback:r(()=>t[0]||(t[0]=[d(" Loading... ")])),_:1})),t[4]||(t[4]=h('<p><strong>关键步骤说明</strong>：</p><ul><li><strong>生成绘制指令</strong>：主线程遍历布局树，为每个元素生成 <strong>绘制指令列表（Paint Records）</strong>，描述其颜色、背景、边框、文本等视觉属性。</li><li><strong>按层划分任务</strong>：每个合成层（Compositing Layer）独立生成绘制指令，避免跨层混合。</li><li><strong>提交至合成线程</strong>：主线程将绘制指令和图层信息传递给合成线程，完成后续处理。</li></ul><blockquote><p>注意：绘制指令是一种底层的、描述如何渲染元素的抽象操作列表，实际由浏览器引擎生成。我们可以暂时理解为类似 <code>canvas api</code> 的指令集。</p></blockquote><h4 id="_5-1-绘制指令类型" tabindex="-1">5.1. 绘制指令类型 <a class="header-anchor" href="#_5-1-绘制指令类型" aria-label="Permalink to &quot;5.1. 绘制指令类型&quot;">​</a></h4><table tabindex="0"><thead><tr><th>指令类型</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td><code>fillRect</code></td><td>填充矩形区域</td><td>背景颜色、边框</td></tr><tr><td><code>drawText</code></td><td>绘制文本</td><td>字体、颜色、阴影</td></tr><tr><td><code>drawImage</code></td><td>绘制图像</td><td>背景图片、图标</td></tr><tr><td><code>drawBorder</code></td><td>绘制边框</td><td>边框样式、圆角</td></tr><tr><td><code>drawShadow</code></td><td>绘制阴影</td><td>文本阴影、盒阴影</td></tr></tbody></table><h4 id="_5-2-绘制状态管理" tabindex="-1">5.2 绘制状态管理 <a class="header-anchor" href="#_5-2-绘制状态管理" aria-label="Permalink to &quot;5.2 绘制状态管理&quot;">​</a></h4><p>绘制过程中，浏览器会维护 <strong>绘制状态栈</strong>，通过 <code>save()</code>（保存当前颜色、字体、变换等状态）和 <code>restore()</code>（恢复上一次保存的状态）管理指令上下文，避免不同元素的绘制属性相互干扰。</p><h4 id="_5-3-绘制顺序规则" tabindex="-1">5.3. 绘制顺序规则 <a class="header-anchor" href="#_5-3-绘制顺序规则" aria-label="Permalink to &quot;5.3. 绘制顺序规则&quot;">​</a></h4><table tabindex="0"><thead><tr><th>因素</th><th>说明</th></tr></thead><tbody><tr><td>文档流顺序</td><td>默认从上到下、从左到右绘制</td></tr><tr><td>堆叠上下文与 z-index</td><td>不同堆叠上下文的元素按 <code>z-index</code> 排序，同一上下文内按 CSS 层叠规则排序</td></tr></tbody></table><ul><li>同一上下文内的绘制顺序见上篇文章：<a href="/vitepress-blog/posts/浏览器渲染原理（二）#_4-1-1-层叠上下文绘制顺序">浏览器渲染原理（二）- 层叠上下文绘制顺序</a></li></ul><h4 id="_5-4-触发重绘的操作" tabindex="-1">5.4. 触发重绘的操作 <a class="header-anchor" href="#_5-4-触发重绘的操作" aria-label="Permalink to &quot;5.4. 触发重绘的操作&quot;">​</a></h4><table tabindex="0"><thead><tr><th>操作</th><th>是否触发重绘</th><th>说明</th></tr></thead><tbody><tr><td>修改颜色、背景</td><td>✅</td><td>如 <code>element.style.backgroundColor = &#39;red&#39;</code></td></tr><tr><td>修改字体大小</td><td>✅</td><td>如 <code>element.style.fontSize = &#39;20px&#39;</code></td></tr><tr><td>修改 transform</td><td>❌（特定场景）</td><td>仅当元素已升级为合成层时，直接由合成线程处理</td></tr><tr><td>修改 opacity</td><td>❌（特定场景）</td><td>仅当元素已升级为合成层时，直接由合成线程处理</td></tr></tbody></table><h4 id="_5-5-绘制指令的优化" tabindex="-1">5.5. 绘制指令的优化 <a class="header-anchor" href="#_5-5-绘制指令的优化" aria-label="Permalink to &quot;5.5. 绘制指令的优化&quot;">​</a></h4><p><strong>优化策略</strong>：</p><p>todo: 待补充，见 <a href="https://web.dev/articles/howbrowserswork?hl=zh-cn#painting" target="_blank" rel="noreferrer">how browsers work</a></p>',15))])}const k=n(_,[["render",b]]);export{x as __pageData,k as default};
